function wt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Le={},Pe={},J={};Object.defineProperty(J,"__esModule",{value:!0});J.presets=J.defaultOptions=void 0;const ct={chrome:{supportedSchemes:["http","https","file","ftp"],schemeStarMatchesWs:!1},firefox:{supportedSchemes:["http","https","ws","wss","ftp","file"],schemeStarMatchesWs:!0}};J.presets=ct;const Ct=Object.assign(Object.assign({},ct.chrome),{strict:!0});J.defaultOptions=Ct;var Me={},ye={},oe={},V={},Z={},Fe;function ut(){if(Fe)return Z;Fe=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.regexEscape=c,Z.exact=l,Z.regexLength=d,Z.getContextAgnosticMap=void 0;var e=_e();const r=Array.from({length:128},(f,_)=>String.fromCodePoint(_)),t=f=>{const _=new Set(f);return _.delete("i"),f=[..._].join(""),r.map(i=>{const g=`\\x${i.codePointAt(0).toString(16).padStart(2,"0")}`;let y=g,A=g,m=g;try{const x=new RegExp(`[${i}]`,f);new RegExp(`[${i}${i}]`,f),new RegExp(`[${i}${i}\0]`,f),x.test(i)&&!r.filter(R=>R!==i).some(R=>x.test(R))?y=i:(new RegExp(`[\\${i}]`,f),y=`\\${i}`)}catch{try{new RegExp(`[\\${i}]`,f),y=`\\${i}`}catch{}}try{const x=new RegExp(`^${i}$`,f);x.test(i)&&!r.filter(R=>R!==i).some(R=>x.test(R))?A=i:(new RegExp(`\\${i}`,f),A=`\\${i}`)}catch{try{new RegExp(`\\${i}`,f),A=`\\${i}`}catch{}}if(y!==A)try{new RegExp(`\\${i}`,f),new RegExp(`\\${i}`,f),m=`\\${i}`}catch{}else m=[y,A].sort((x,R)=>R.length-x.length)[0];return{ch:i,agnostic:m,inClass:y,outsideClass:A}}).filter(i=>i.inClass!==i.ch||i.outsideClass!==i.ch)},n=new Map,a=f=>{const _=n.get(f);if(_)return _;const i=Object.fromEntries(t(f).map(g=>[g.ch,g.agnostic]));return n.set(f,i),i};Z.getContextAgnosticMap=a;function c(f,_="u"){const i=a(_),g=Object.values(i),y=A=>A.replace(new RegExp(`[${g.join("")}]`,[...new Set([..._,..."g"])].join("")),m=>i[m]);return new e.RegexFragment(y(f))}function l(f,_){return(0,e.regex)(_)`${f}`}function d(f){return f.replace(/\\(?:\w\{[^}]+\}|u[0-9a-f]{4}|x[0-9a-f]{2}|[0-8]{3}|c[A-Z]|.)/gi,".").length}return Z}var Qe;function _e(){if(Qe)return V;Qe=1,Object.defineProperty(V,"__esModule",{value:!0}),V.regex=_,V.LazyAlternation=V.RegexFragment=void 0;var e=ut();class r extends String{}V.RegexFragment=r;class t extends Array{constructor(...g){super(...Array.isArray(g[0])?g[0]:g)}}V.LazyAlternation=t;const n={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"},a=/(\\*)#(.*)/g,c=i=>i!==!1&&i!=null,l=(i,g,y)=>g.length%2?g.slice(1)+"#"+y.replace(a,l):g,d=i=>g=>{if(g instanceof RegExp){if(g.flags===i)return g.source;{const y=(0,e.getContextAgnosticMap)(g.flags),A=(0,e.getContextAgnosticMap)(i),m=[];for(const R of Object.keys(y))y[R]!==A[R]&&m.push(y[R]);for(const R of Object.keys(A))y[R]!==A[R]&&m.push(R);const x=new RegExp(`(?:${m.map(R=>(0,e.regexEscape)(R,"i")).join("|")})`,"gi");return m.length?g.source.replace(x,R=>{var P;return(P=A[R.startsWith("\\")?R.slice(1):R])!==null&&P!==void 0?P:R}):g.source}}else return typeof g=="string"?(0,e.regexEscape)(g,i):String(c(g)?g:"")},f=(i={})=>(g,...y)=>{let A="",m=[];typeof i=="string"?m=[...i]:Object.entries(n).forEach(([R,P])=>{i[R]&&m.push(P)});const x=m.sort((R,P)=>R.localeCompare(P)).join("");return g.raw.forEach((R,P)=>{A+=R.replace(a,l).replace(/\\`/g,"`").replace(/(\\*)(\s+)/g,(B,N,M)=>M[0]===" "&&N.length%2?N.slice(1)+M[0]:N);const $=y[P];if(Array.isArray($)){const B=$ instanceof t?-1:1;A+=`(?:${[...new Set([...$.filter(c).map(N=>String(d(x)(N)))])].sort((N,M)=>B*((0,e.regexLength)(M)-(0,e.regexLength)(N))).join("|")})`}else A+=d(x)($)}),new RegExp(A,x)};function _(...i){if(Array.isArray(i[0])){const[g,...y]=i;return f("")(g,...y)}else{const[g]=i;return f(g)}}return V}var ke={};Object.defineProperty(ke,"__esModule",{value:!0});ke.unwrap=Ot;var We=_e();function Ot(e,r){const t=e.source.replace(/^\^?([\s\S]*?)\$?$/,"$1");return(0,We.regex)(r??e.flags)`${new We.RegexFragment(t)}`}var Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.proxy=void 0;var Lt=_e();const Tt=new Proxy(Lt.regex,{get(e,r){return e(r==="_"?"":r)},apply(e,r,t){return e(...t)}});Re.proxy=Tt;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"regex",{enumerable:!0,get:function(){return r.regex}}),Object.defineProperty(e,"RegexFragment",{enumerable:!0,get:function(){return r.RegexFragment}}),Object.defineProperty(e,"LazyAlternation",{enumerable:!0,get:function(){return r.LazyAlternation}}),Object.defineProperty(e,"exact",{enumerable:!0,get:function(){return t.exact}}),Object.defineProperty(e,"regexEscape",{enumerable:!0,get:function(){return t.regexEscape}}),Object.defineProperty(e,"unwrap",{enumerable:!0,get:function(){return n.unwrap}}),Object.defineProperty(e,"proxy",{enumerable:!0,get:function(){return a.proxy}});var r=_e(),t=ut(),n=ke,a=Re})(oe);Object.defineProperty(ye,"__esModule",{value:!0});ye.getDummyUrl=Ht;var Ke=oe;const qe=/^|$|[/?=&\-]/;function Ht(e,r={}){const{rawHost:t,rawPathAndQuery:n}=e,{defaultScheme:a="https",subdomain:c="",pathAndQueryReplacer:l="",rootDomain:d="example.com",strict:f=!0}=r;let _;const i=e.scheme==="*"?a:e.scheme;i==="file"?_="":t==="*"?_=[c,d].filter(Boolean).join("."):_=t.replace(/^\*./,c?`${c}.`:"");const g=(f?n:"/*").replace(/\*/g,`-${l}-`).replace((0,Ke.regex)("g")`-+(${qe})`,"$1").replace((0,Ke.regex)("g")`(${qe})-+`,"$1").replace(/\/+/g,"/");try{return new URL(`${i}://${_}${g}`)}catch{return null}}var Ee={},ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.ALL_URLS=void 0;const Pt="<all_urls>";ae.ALL_URLS=Pt;Object.defineProperty(Ee,"__esModule",{value:!0});Ee.getPatternSegments=Ut;var Mt=oe,kt=ae;const It=(0,Mt.regex)()`
	^
		(\*|\w+)      # scheme
		://
		(
			\*     |  # Any host
			[^/\#]*     # Only the given host (optional only if scheme is file)
		)
		(/[^\r\n\#]*) # path
	$
`;function Ut(e){if(e===kt.ALL_URLS)return{pattern:e,scheme:"*",rawHost:"*",rawPathAndQuery:"/*"};const r=e.match(It);if(!r)return null;const[,t,n,a]=r;return{pattern:e,scheme:t,rawHost:n,rawPathAndQuery:a}}Object.defineProperty(Me,"__esModule",{value:!0});Me.getExampleUrls=jt;var Nt=ye,Dt=Ee;function jt(e,r){const t=(0,Dt.getPatternSegments)(e),{supportedSchemes:n,strict:a}=r,c=["","www","foo.bar"],l=["example.com"],d=["","foo","/bar/baz/"],f=n.flatMap(_=>c.flatMap(i=>l.flatMap(g=>d.flatMap(y=>(0,Nt.getDummyUrl)(t,{defaultScheme:_,subdomain:i,rootDomain:g,pathAndQueryReplacer:y,strict:a})))));return[...new Set(f.filter(Boolean).map(_=>_.href))]}var Ie={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.getHostRegex=Gt;var Xe=oe,Bt=ye;function Gt(e){const{pattern:r,scheme:t,rawHost:n}=e;if(!n&&t!=="file")return new TypeError('Host is optional only if the scheme is "file".');const a=n.includes("*");if(a){const f=n.split("*.");if(n.length>1&&(f.length!==2||f[0]||!f[1]))return new TypeError('Host can contain only one wildcard at the start, in the form "*.<host segments>"')}const c=(0,Bt.getDummyUrl)(e,{subdomain:""});if(!c)return new TypeError(`Pattern "${r}" cannot be used to construct a valid URL.`);const l=c.host;if(/:\d+$/.test(l))return new TypeError(`Host "${n}" cannot include a port number. All ports are matched by default.`);if(/[^.a-z0-9\-]/.test(l))return new TypeError(`Host "${n}" contains invalid characters.`);const d=a?"*."+l:l;return n==="*"?/.+/:d.startsWith("*.")?(0,Xe.regex)()`
			^
				(?:[^.]+\.)*     # any number of dot-terminated segments
				${d.slice(2)}   # rest after leading *.
			$
		`:(0,Xe.regex)()`^${d}$`}var ce={};Object.defineProperty(ce,"__esModule",{value:!0});ce.createMatchFn=Ft;ce.normalizeUrlFragment=void 0;const Te=e=>{try{return encodeURI(decodeURI(e))}catch(r){return r}};ce.normalizeUrlFragment=Te;function Ft(e){return r=>{let t;try{const n=r instanceof URL?r.href:r;t=new URL(n);const a=Te(t.pathname),c=Te(t.search);if(a instanceof Error||c instanceof Error)return!1;t.pathname=a,t.href.endsWith("?")||(t.search=c)}catch{return!1}return e(t)}}Object.defineProperty(Ie,"__esModule",{value:!0});Ie.toMatchFnOrError=qt;var ee=oe,Qt=ae,Wt=Ue,Kt=Ee,ve=ce;function qt(e,r){var t;const{supportedSchemes:n,schemeStarMatchesWs:a,strict:c}=r;if(e===Qt.ALL_URLS)return(0,ve.createMatchFn)(m=>(0,ee.regex)()`
				^
					(?:${n})
					:
				$
			`.test(m.protocol));const l=(t=e.match(/^(urn|data):/))===null||t===void 0?void 0:t[1];if(l)return new TypeError(`browser-extension-url-match does not currently support scheme "${l}"`);const d=(0,Kt.getPatternSegments)(e);if(!d){try{const m=new URL(e);if(m.hash||m.href.endsWith("#"))return new TypeError(`Pattern cannot contain a hash: "${e}" contains hash "${m.hash||"#"}"`);if(!e.slice(m.origin.length).startsWith("/"))return new TypeError(`Pattern "${e}" does not contain a path. Use "${e}/*" to match any paths with that origin or "${e}/" to match that URL alone`)}catch{}return new TypeError(`Pattern "${e}" is invalid`)}const{scheme:f,rawPathAndQuery:_}=d;if(f!=="*"&&!n.includes(f))return new TypeError(`Scheme "${f}" is not supported`);const i=(0,ee.regex)()`${f==="*"?new ee.RegexFragment(["https?",a&&"wss?"].filter(Boolean).join("|")):f}:`,g=(0,Wt.getHostRegex)(d);if(g instanceof Error)return g;const y=c?(0,ve.normalizeUrlFragment)(_):"/*";if(y instanceof Error)return y;const A=(0,ee.regex)()`^${new ee.RegexFragment(y.split("*").map(m=>(0,ee.regexEscape)(m)).join(".*"))}$`;return(0,ve.createMatchFn)(m=>{const x=m.pathname+(m.href.endsWith("?")?"?":m.search);return i.test(m.protocol)&&g.test(m.hostname)&&A.test(x)})}Object.defineProperty(Pe,"__esModule",{value:!0});Pe.matchPattern=Yt;var Xt=J,zt=Me,Vt=Ie;function pe(){if(!this.valid)throw new TypeError(this.error.message);return this}function ze(e){return r=>{const t=Object.assign(Object.assign({},Xt.defaultOptions),e),n=(0,Vt.toMatchFnOrError)(r,t);return n instanceof Error?{valid:!1,error:n,assertValid:pe}:{valid:!0,match:n,get examples(){return(0,zt.getExampleUrls)(r,t).filter(a=>n(a)).slice(0,100)},patterns:[r],config:t,assertValid:pe}}}function Zt(e){return e.every(r=>r.valid)}function Yt(e,r={}){const t=typeof e=="string"?[e]:[...new Set(e)];if(t.length===1)return ze(r)(t[0]);const n=t.map(ze(r));return Zt(n)?{valid:!0,get examples(){return[...new Set(n.flatMap(a=>a.examples))]},match:a=>n.some(c=>c.match(a)),patterns:t,config:r,assertValid:pe}:{valid:!1,error:n.find(c=>!c.valid).error,assertValid:pe}}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"matchPattern",{enumerable:!0,get:function(){return r.matchPattern}}),Object.defineProperty(e,"presets",{enumerable:!0,get:function(){return t.presets}});var r=Pe,t=J})(Le);var ue={};const W="\\\\/",Ve=`[^${W}]`,X="\\.",Jt="\\+",er="\\?",Ae="\\/",tr="(?=.)",it="[^/]",Ne=`(?:${Ae}|$)`,lt=`(?:^|${Ae})`,De=`${X}{1,2}${Ne}`,rr=`(?!${X})`,nr=`(?!${lt}${De})`,sr=`(?!${X}{0,1}${Ne})`,or=`(?!${De})`,ar=`[^.${Ae}]`,cr=`${it}*?`,ur="/",ft={DOT_LITERAL:X,PLUS_LITERAL:Jt,QMARK_LITERAL:er,SLASH_LITERAL:Ae,ONE_CHAR:tr,QMARK:it,END_ANCHOR:Ne,DOTS_SLASH:De,NO_DOT:rr,NO_DOTS:nr,NO_DOT_SLASH:sr,NO_DOTS_SLASH:or,QMARK_NO_DOT:ar,STAR:cr,START_ANCHOR:lt,SEP:ur},ir={...ft,SLASH_LITERAL:`[${W}]`,QMARK:Ve,STAR:`${Ve}*?`,DOTS_SLASH:`${X}{1,2}(?:[${W}]|$)`,NO_DOT:`(?!${X})`,NO_DOTS:`(?!(?:^|[${W}])${X}{1,2}(?:[${W}]|$))`,NO_DOT_SLASH:`(?!${X}{0,1}(?:[${W}]|$))`,NO_DOTS_SLASH:`(?!${X}{1,2}(?:[${W}]|$))`,QMARK_NO_DOT:`[^.${W}]`,START_ANCHOR:`(?:^|[${W}])`,END_ANCHOR:`(?:[${W}]|$)`,SEP:"\\"},lr={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};var xe={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:lr,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{__proto__:null,"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,extglobChars(e){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(e){return e===!0?ir:ft}};(function(e){const{REGEX_BACKSLASH:r,REGEX_REMOVE_BACKSLASH:t,REGEX_SPECIAL_CHARS:n,REGEX_SPECIAL_CHARS_GLOBAL:a}=xe;e.isObject=c=>c!==null&&typeof c=="object"&&!Array.isArray(c),e.hasRegexChars=c=>n.test(c),e.isRegexChar=c=>c.length===1&&e.hasRegexChars(c),e.escapeRegex=c=>c.replace(a,"\\$1"),e.toPosixSlashes=c=>c.replace(r,"/"),e.isWindows=()=>{if(typeof navigator<"u"&&navigator.platform){const c=navigator.platform.toLowerCase();return c==="win32"||c==="windows"}return typeof process<"u"&&process.platform?process.platform==="win32":!1},e.removeBackslashes=c=>c.replace(t,l=>l==="\\"?"":l),e.escapeLast=(c,l,d)=>{const f=c.lastIndexOf(l,d);return f===-1?c:c[f-1]==="\\"?e.escapeLast(c,l,f-1):`${c.slice(0,f)}\\${c.slice(f)}`},e.removePrefix=(c,l={})=>{let d=c;return d.startsWith("./")&&(d=d.slice(2),l.prefix="./"),d},e.wrapOutput=(c,l={},d={})=>{const f=d.contains?"":"^",_=d.contains?"":"$";let i=`${f}(?:${c})${_}`;return l.negated===!0&&(i=`(?:^(?!${i}).*$)`),i},e.basename=(c,{windows:l}={})=>{const d=c.split(l?/[\\/]/:"/"),f=d[d.length-1];return f===""?d[d.length-2]:f}})(ue);const Ze=ue,{CHAR_ASTERISK:be,CHAR_AT:fr,CHAR_BACKWARD_SLASH:se,CHAR_COMMA:pr,CHAR_DOT:$e,CHAR_EXCLAMATION_MARK:we,CHAR_FORWARD_SLASH:pt,CHAR_LEFT_CURLY_BRACE:Ce,CHAR_LEFT_PARENTHESES:Oe,CHAR_LEFT_SQUARE_BRACKET:hr,CHAR_PLUS:dr,CHAR_QUESTION_MARK:Ye,CHAR_RIGHT_CURLY_BRACE:gr,CHAR_RIGHT_PARENTHESES:Je,CHAR_RIGHT_SQUARE_BRACKET:mr}=xe,et=e=>e===pt||e===se,tt=e=>{e.isPrefix!==!0&&(e.depth=e.isGlobstar?1/0:1)},yr=(e,r)=>{const t=r||{},n=e.length-1,a=t.parts===!0||t.scanToEnd===!0,c=[],l=[],d=[];let f=e,_=-1,i=0,g=0,y=!1,A=!1,m=!1,x=!1,R=!1,P=!1,$=!1,B=!1,N=!1,M=!1,U=0,G,E,v={value:"",depth:0,isGlob:!1};const u=()=>_>=n,j=()=>f.charCodeAt(_+1),k=()=>(G=E,f.charCodeAt(++_));for(;_<n;){E=k();let w;if(E===se){$=v.backslashes=!0,E=k(),E===Ce&&(P=!0);continue}if(P===!0||E===Ce){for(U++;u()!==!0&&(E=k());){if(E===se){$=v.backslashes=!0,k();continue}if(E===Ce){U++;continue}if(P!==!0&&E===$e&&(E=k())===$e){if(y=v.isBrace=!0,m=v.isGlob=!0,M=!0,a===!0)continue;break}if(P!==!0&&E===pr){if(y=v.isBrace=!0,m=v.isGlob=!0,M=!0,a===!0)continue;break}if(E===gr&&(U--,U===0)){P=!1,y=v.isBrace=!0,M=!0;break}}if(a===!0)continue;break}if(E===pt){if(c.push(_),l.push(v),v={value:"",depth:0,isGlob:!1},M===!0)continue;if(G===$e&&_===i+1){i+=2;continue}g=_+1;continue}if(t.noext!==!0&&(E===dr||E===fr||E===be||E===Ye||E===we)===!0&&j()===Oe){if(m=v.isGlob=!0,x=v.isExtglob=!0,M=!0,E===we&&_===i&&(N=!0),a===!0){for(;u()!==!0&&(E=k());){if(E===se){$=v.backslashes=!0,E=k();continue}if(E===Je){m=v.isGlob=!0,M=!0;break}}continue}break}if(E===be){if(G===be&&(R=v.isGlobstar=!0),m=v.isGlob=!0,M=!0,a===!0)continue;break}if(E===Ye){if(m=v.isGlob=!0,M=!0,a===!0)continue;break}if(E===hr){for(;u()!==!0&&(w=k());){if(w===se){$=v.backslashes=!0,k();continue}if(w===mr){A=v.isBracket=!0,m=v.isGlob=!0,M=!0;break}}if(a===!0)continue;break}if(t.nonegate!==!0&&E===we&&_===i){B=v.negated=!0,i++;continue}if(t.noparen!==!0&&E===Oe){if(m=v.isGlob=!0,a===!0){for(;u()!==!0&&(E=k());){if(E===Oe){$=v.backslashes=!0,E=k();continue}if(E===Je){M=!0;break}}continue}break}if(m===!0){if(M=!0,a===!0)continue;break}}t.noext===!0&&(x=!1,m=!1);let T=f,s="",o="";i>0&&(s=f.slice(0,i),f=f.slice(i),g-=i),T&&m===!0&&g>0?(T=f.slice(0,g),o=f.slice(g)):m===!0?(T="",o=f):T=f,T&&T!==""&&T!=="/"&&T!==f&&et(T.charCodeAt(T.length-1))&&(T=T.slice(0,-1)),t.unescape===!0&&(o&&(o=Ze.removeBackslashes(o)),T&&$===!0&&(T=Ze.removeBackslashes(T)));const F={prefix:s,input:e,start:i,base:T,glob:o,isBrace:y,isBracket:A,isGlob:m,isExtglob:x,isGlobstar:R,negated:B,negatedExtglob:N};if(t.tokens===!0&&(F.maxDepth=0,et(E)||l.push(v),F.tokens=l),t.parts===!0||t.tokens===!0){let w;for(let O=0;O<c.length;O++){const q=w?w+1:i,Q=c[O],z=e.slice(q,Q);t.tokens&&(O===0&&i!==0?(l[O].isPrefix=!0,l[O].value=s):l[O].value=z,tt(l[O]),F.maxDepth+=l[O].depth),(O!==0||z!=="")&&d.push(z),w=Q}if(w&&w+1<e.length){const O=e.slice(w+1);d.push(O),t.tokens&&(l[l.length-1].value=O,tt(l[l.length-1]),F.maxDepth+=l[l.length-1].depth)}F.slashes=c,F.parts=d}return F};var _r=yr;const he=xe,K=ue,{MAX_LENGTH:de,POSIX_REGEX_SOURCE:Rr,REGEX_NON_SPECIAL_CHARS:Er,REGEX_SPECIAL_CHARS_BACKREF:Ar,REPLACEMENTS:ht}=he,xr=(e,r)=>{if(typeof r.expandRange=="function")return r.expandRange(...e,r);e.sort();const t=`[${e.join("-")}]`;try{new RegExp(t)}catch{return e.map(a=>K.escapeRegex(a)).join("..")}return t},te=(e,r)=>`Missing ${e}: "${r}" - use "\\\\${r}" to match literal characters`,je=(e,r)=>{if(typeof e!="string")throw new TypeError("Expected a string");e=ht[e]||e;const t={...r},n=typeof t.maxLength=="number"?Math.min(de,t.maxLength):de;let a=e.length;if(a>n)throw new SyntaxError(`Input length: ${a}, exceeds maximum allowed length: ${n}`);const c={type:"bos",value:"",output:t.prepend||""},l=[c],d=t.capture?"":"?:",f=he.globChars(t.windows),_=he.extglobChars(f),{DOT_LITERAL:i,PLUS_LITERAL:g,SLASH_LITERAL:y,ONE_CHAR:A,DOTS_SLASH:m,NO_DOT:x,NO_DOT_SLASH:R,NO_DOTS_SLASH:P,QMARK:$,QMARK_NO_DOT:B,STAR:N,START_ANCHOR:M}=f,U=h=>`(${d}(?:(?!${M}${h.dot?m:i}).)*?)`,G=t.dot?"":x,E=t.dot?$:B;let v=t.bash===!0?U(t):N;t.capture&&(v=`(${v})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);const u={input:e,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:l};e=K.removePrefix(e,u),a=e.length;const j=[],k=[],T=[];let s=c,o;const F=()=>u.index===a-1,w=u.peek=(h=1)=>e[u.index+h],O=u.advance=()=>e[++u.index]||"",q=()=>e.slice(u.index+1),Q=(h="",C=0)=>{u.consumed+=h,u.index+=C},z=h=>{u.output+=h.output!=null?h.output:h.value,Q(h.value)},bt=()=>{let h=1;for(;w()==="!"&&(w(2)!=="("||w(3)==="?");)O(),u.start++,h++;return h%2===0?!1:(u.negated=!0,u.start++,!0)},ie=h=>{u[h]++,T.push(h)},Y=h=>{u[h]--,T.pop()},b=h=>{if(s.type==="globstar"){const C=u.braces>0&&(h.type==="comma"||h.type==="brace"),p=h.extglob===!0||j.length&&(h.type==="pipe"||h.type==="paren");h.type!=="slash"&&h.type!=="paren"&&!C&&!p&&(u.output=u.output.slice(0,-s.output.length),s.type="star",s.value="*",s.output=v,u.output+=s.output)}if(j.length&&h.type!=="paren"&&(j[j.length-1].inner+=h.value),(h.value||h.output)&&z(h),s&&s.type==="text"&&h.type==="text"){s.output=(s.output||s.value)+h.value,s.value+=h.value;return}h.prev=s,l.push(h),s=h},le=(h,C)=>{const p={..._[C],conditions:1,inner:""};p.prev=s,p.parens=u.parens,p.output=u.output;const S=(t.capture?"(":"")+p.open;ie("parens"),b({type:h,value:C,output:u.output?"":A}),b({type:"paren",extglob:!0,value:O(),output:S}),j.push(p)},$t=h=>{let C=h.close+(t.capture?")":""),p;if(h.type==="negate"){let S=v;if(h.inner&&h.inner.length>1&&h.inner.includes("/")&&(S=U(t)),(S!==v||F()||/^\)+$/.test(q()))&&(C=h.close=`)$))${S}`),h.inner.includes("*")&&(p=q())&&/^\.[^\\/.]+$/.test(p)){const L=je(p,{...r,fastpaths:!1}).output;C=h.close=`)${L})${S})`}h.prev.type==="bos"&&(u.negatedExtglob=!0)}b({type:"paren",extglob:!0,value:o,output:C}),Y("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(e)){let h=!1,C=e.replace(Ar,(p,S,L,D,I,Se)=>D==="\\"?(h=!0,p):D==="?"?S?S+D+(I?$.repeat(I.length):""):Se===0?E+(I?$.repeat(I.length):""):$.repeat(L.length):D==="."?i.repeat(L.length):D==="*"?S?S+D+(I?v:""):v:S?p:`\\${p}`);return h===!0&&(t.unescape===!0?C=C.replace(/\\/g,""):C=C.replace(/\\+/g,p=>p.length%2===0?"\\\\":p?"\\":"")),C===e&&t.contains===!0?(u.output=e,u):(u.output=K.wrapOutput(C,u,r),u)}for(;!F();){if(o=O(),o==="\0")continue;if(o==="\\"){const p=w();if(p==="/"&&t.bash!==!0||p==="."||p===";")continue;if(!p){o+="\\",b({type:"text",value:o});continue}const S=/^\\+/.exec(q());let L=0;if(S&&S[0].length>2&&(L=S[0].length,u.index+=L,L%2!==0&&(o+="\\")),t.unescape===!0?o=O():o+=O(),u.brackets===0){b({type:"text",value:o});continue}}if(u.brackets>0&&(o!=="]"||s.value==="["||s.value==="[^")){if(t.posix!==!1&&o===":"){const p=s.value.slice(1);if(p.includes("[")&&(s.posix=!0,p.includes(":"))){const S=s.value.lastIndexOf("["),L=s.value.slice(0,S),D=s.value.slice(S+2),I=Rr[D];if(I){s.value=L+I,u.backtrack=!0,O(),!c.output&&l.indexOf(s)===1&&(c.output=A);continue}}}(o==="["&&w()!==":"||o==="-"&&w()==="]")&&(o=`\\${o}`),o==="]"&&(s.value==="["||s.value==="[^")&&(o=`\\${o}`),t.posix===!0&&o==="!"&&s.value==="["&&(o="^"),s.value+=o,z({value:o});continue}if(u.quotes===1&&o!=='"'){o=K.escapeRegex(o),s.value+=o,z({value:o});continue}if(o==='"'){u.quotes=u.quotes===1?0:1,t.keepQuotes===!0&&b({type:"text",value:o});continue}if(o==="("){ie("parens"),b({type:"paren",value:o});continue}if(o===")"){if(u.parens===0&&t.strictBrackets===!0)throw new SyntaxError(te("opening","("));const p=j[j.length-1];if(p&&u.parens===p.parens+1){$t(j.pop());continue}b({type:"paren",value:o,output:u.parens?")":"\\)"}),Y("parens");continue}if(o==="["){if(t.nobracket===!0||!q().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(te("closing","]"));o=`\\${o}`}else ie("brackets");b({type:"bracket",value:o});continue}if(o==="]"){if(t.nobracket===!0||s&&s.type==="bracket"&&s.value.length===1){b({type:"text",value:o,output:`\\${o}`});continue}if(u.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(te("opening","["));b({type:"text",value:o,output:`\\${o}`});continue}Y("brackets");const p=s.value.slice(1);if(s.posix!==!0&&p[0]==="^"&&!p.includes("/")&&(o=`/${o}`),s.value+=o,z({value:o}),t.literalBrackets===!1||K.hasRegexChars(p))continue;const S=K.escapeRegex(s.value);if(u.output=u.output.slice(0,-s.value.length),t.literalBrackets===!0){u.output+=S,s.value=S;continue}s.value=`(${d}${S}|${s.value})`,u.output+=s.value;continue}if(o==="{"&&t.nobrace!==!0){ie("braces");const p={type:"brace",value:o,output:"(",outputIndex:u.output.length,tokensIndex:u.tokens.length};k.push(p),b(p);continue}if(o==="}"){const p=k[k.length-1];if(t.nobrace===!0||!p){b({type:"text",value:o,output:o});continue}let S=")";if(p.dots===!0){const L=l.slice(),D=[];for(let I=L.length-1;I>=0&&(l.pop(),L[I].type!=="brace");I--)L[I].type!=="dots"&&D.unshift(L[I].value);S=xr(D,t),u.backtrack=!0}if(p.comma!==!0&&p.dots!==!0){const L=u.output.slice(0,p.outputIndex),D=u.tokens.slice(p.tokensIndex);p.value=p.output="\\{",o=S="\\}",u.output=L;for(const I of D)u.output+=I.output||I.value}b({type:"brace",value:o,output:S}),Y("braces"),k.pop();continue}if(o==="|"){j.length>0&&j[j.length-1].conditions++,b({type:"text",value:o});continue}if(o===","){let p=o;const S=k[k.length-1];S&&T[T.length-1]==="braces"&&(S.comma=!0,p="|"),b({type:"comma",value:o,output:p});continue}if(o==="/"){if(s.type==="dot"&&u.index===u.start+1){u.start=u.index+1,u.consumed="",u.output="",l.pop(),s=c;continue}b({type:"slash",value:o,output:y});continue}if(o==="."){if(u.braces>0&&s.type==="dot"){s.value==="."&&(s.output=i);const p=k[k.length-1];s.type="dots",s.output+=o,s.value+=o,p.dots=!0;continue}if(u.braces+u.parens===0&&s.type!=="bos"&&s.type!=="slash"){b({type:"text",value:o,output:i});continue}b({type:"dot",value:o,output:i});continue}if(o==="?"){if(!(s&&s.value==="(")&&t.noextglob!==!0&&w()==="("&&w(2)!=="?"){le("qmark",o);continue}if(s&&s.type==="paren"){const S=w();let L=o;(s.value==="("&&!/[!=<:]/.test(S)||S==="<"&&!/<([!=]|\w+>)/.test(q()))&&(L=`\\${o}`),b({type:"text",value:o,output:L});continue}if(t.dot!==!0&&(s.type==="slash"||s.type==="bos")){b({type:"qmark",value:o,output:B});continue}b({type:"qmark",value:o,output:$});continue}if(o==="!"){if(t.noextglob!==!0&&w()==="("&&(w(2)!=="?"||!/[!=<:]/.test(w(3)))){le("negate",o);continue}if(t.nonegate!==!0&&u.index===0){bt();continue}}if(o==="+"){if(t.noextglob!==!0&&w()==="("&&w(2)!=="?"){le("plus",o);continue}if(s&&s.value==="("||t.regex===!1){b({type:"plus",value:o,output:g});continue}if(s&&(s.type==="bracket"||s.type==="paren"||s.type==="brace")||u.parens>0){b({type:"plus",value:o});continue}b({type:"plus",value:g});continue}if(o==="@"){if(t.noextglob!==!0&&w()==="("&&w(2)!=="?"){b({type:"at",extglob:!0,value:o,output:""});continue}b({type:"text",value:o});continue}if(o!=="*"){(o==="$"||o==="^")&&(o=`\\${o}`);const p=Er.exec(q());p&&(o+=p[0],u.index+=p[0].length),b({type:"text",value:o});continue}if(s&&(s.type==="globstar"||s.star===!0)){s.type="star",s.star=!0,s.value+=o,s.output=v,u.backtrack=!0,u.globstar=!0,Q(o);continue}let h=q();if(t.noextglob!==!0&&/^\([^?]/.test(h)){le("star",o);continue}if(s.type==="star"){if(t.noglobstar===!0){Q(o);continue}const p=s.prev,S=p.prev,L=p.type==="slash"||p.type==="bos",D=S&&(S.type==="star"||S.type==="globstar");if(t.bash===!0&&(!L||h[0]&&h[0]!=="/")){b({type:"star",value:o,output:""});continue}const I=u.braces>0&&(p.type==="comma"||p.type==="brace"),Se=j.length&&(p.type==="pipe"||p.type==="paren");if(!L&&p.type!=="paren"&&!I&&!Se){b({type:"star",value:o,output:""});continue}for(;h.slice(0,3)==="/**";){const fe=e[u.index+4];if(fe&&fe!=="/")break;h=h.slice(3),Q("/**",3)}if(p.type==="bos"&&F()){s.type="globstar",s.value+=o,s.output=U(t),u.output=s.output,u.globstar=!0,Q(o);continue}if(p.type==="slash"&&p.prev.type!=="bos"&&!D&&F()){u.output=u.output.slice(0,-(p.output+s.output).length),p.output=`(?:${p.output}`,s.type="globstar",s.output=U(t)+(t.strictSlashes?")":"|$)"),s.value+=o,u.globstar=!0,u.output+=p.output+s.output,Q(o);continue}if(p.type==="slash"&&p.prev.type!=="bos"&&h[0]==="/"){const fe=h[1]!==void 0?"|$":"";u.output=u.output.slice(0,-(p.output+s.output).length),p.output=`(?:${p.output}`,s.type="globstar",s.output=`${U(t)}${y}|${y}${fe})`,s.value+=o,u.output+=p.output+s.output,u.globstar=!0,Q(o+O()),b({type:"slash",value:"/",output:""});continue}if(p.type==="bos"&&h[0]==="/"){s.type="globstar",s.value+=o,s.output=`(?:^|${y}|${U(t)}${y})`,u.output=s.output,u.globstar=!0,Q(o+O()),b({type:"slash",value:"/",output:""});continue}u.output=u.output.slice(0,-s.output.length),s.type="globstar",s.output=U(t),s.value+=o,u.output+=s.output,u.globstar=!0,Q(o);continue}const C={type:"star",value:o,output:v};if(t.bash===!0){C.output=".*?",(s.type==="bos"||s.type==="slash")&&(C.output=G+C.output),b(C);continue}if(s&&(s.type==="bracket"||s.type==="paren")&&t.regex===!0){C.output=o,b(C);continue}(u.index===u.start||s.type==="slash"||s.type==="dot")&&(s.type==="dot"?(u.output+=R,s.output+=R):t.dot===!0?(u.output+=P,s.output+=P):(u.output+=G,s.output+=G),w()!=="*"&&(u.output+=A,s.output+=A)),b(C)}for(;u.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(te("closing","]"));u.output=K.escapeLast(u.output,"["),Y("brackets")}for(;u.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(te("closing",")"));u.output=K.escapeLast(u.output,"("),Y("parens")}for(;u.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(te("closing","}"));u.output=K.escapeLast(u.output,"{"),Y("braces")}if(t.strictSlashes!==!0&&(s.type==="star"||s.type==="bracket")&&b({type:"maybe_slash",value:"",output:`${y}?`}),u.backtrack===!0){u.output="";for(const h of u.tokens)u.output+=h.output!=null?h.output:h.value,h.suffix&&(u.output+=h.suffix)}return u};je.fastpaths=(e,r)=>{const t={...r},n=typeof t.maxLength=="number"?Math.min(de,t.maxLength):de,a=e.length;if(a>n)throw new SyntaxError(`Input length: ${a}, exceeds maximum allowed length: ${n}`);e=ht[e]||e;const{DOT_LITERAL:c,SLASH_LITERAL:l,ONE_CHAR:d,DOTS_SLASH:f,NO_DOT:_,NO_DOTS:i,NO_DOTS_SLASH:g,STAR:y,START_ANCHOR:A}=he.globChars(t.windows),m=t.dot?i:_,x=t.dot?g:_,R=t.capture?"":"?:",P={negated:!1,prefix:""};let $=t.bash===!0?".*?":y;t.capture&&($=`(${$})`);const B=G=>G.noglobstar===!0?$:`(${R}(?:(?!${A}${G.dot?f:c}).)*?)`,N=G=>{switch(G){case"*":return`${m}${d}${$}`;case".*":return`${c}${d}${$}`;case"*.*":return`${m}${$}${c}${d}${$}`;case"*/*":return`${m}${$}${l}${d}${x}${$}`;case"**":return m+B(t);case"**/*":return`(?:${m}${B(t)}${l})?${x}${d}${$}`;case"**/*.*":return`(?:${m}${B(t)}${l})?${x}${$}${c}${d}${$}`;case"**/.*":return`(?:${m}${B(t)}${l})?${c}${d}${$}`;default:{const E=/^(.*?)\.(\w+)$/.exec(G);if(!E)return;const v=N(E[1]);return v?v+c+E[2]:void 0}}},M=K.removePrefix(e,P);let U=N(M);return U&&t.strictSlashes!==!0&&(U+=`${l}?`),U};var Sr=je;const vr=_r,He=Sr,dt=ue,br=xe,$r=e=>e&&typeof e=="object"&&!Array.isArray(e),H=(e,r,t=!1)=>{if(Array.isArray(e)){const i=e.map(y=>H(y,r,t));return y=>{for(const A of i){const m=A(y);if(m)return m}return!1}}const n=$r(e)&&e.tokens&&e.input;if(e===""||typeof e!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");const a=r||{},c=a.windows,l=n?H.compileRe(e,r):H.makeRe(e,r,!1,!0),d=l.state;delete l.state;let f=()=>!1;if(a.ignore){const i={...r,ignore:null,onMatch:null,onResult:null};f=H(a.ignore,i,t)}const _=(i,g=!1)=>{const{isMatch:y,match:A,output:m}=H.test(i,l,r,{glob:e,posix:c}),x={glob:e,state:d,regex:l,posix:c,input:i,output:m,match:A,isMatch:y};return typeof a.onResult=="function"&&a.onResult(x),y===!1?(x.isMatch=!1,g?x:!1):f(i)?(typeof a.onIgnore=="function"&&a.onIgnore(x),x.isMatch=!1,g?x:!1):(typeof a.onMatch=="function"&&a.onMatch(x),g?x:!0)};return t&&(_.state=d),_};H.test=(e,r,t,{glob:n,posix:a}={})=>{if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e==="")return{isMatch:!1,output:""};const c=t||{},l=c.format||(a?dt.toPosixSlashes:null);let d=e===n,f=d&&l?l(e):e;return d===!1&&(f=l?l(e):e,d=f===n),(d===!1||c.capture===!0)&&(c.matchBase===!0||c.basename===!0?d=H.matchBase(e,r,t,a):d=r.exec(f)),{isMatch:!!d,match:d,output:f}};H.matchBase=(e,r,t)=>(r instanceof RegExp?r:H.makeRe(r,t)).test(dt.basename(e));H.isMatch=(e,r,t)=>H(r,t)(e);H.parse=(e,r)=>Array.isArray(e)?e.map(t=>H.parse(t,r)):He(e,{...r,fastpaths:!1});H.scan=(e,r)=>vr(e,r);H.compileRe=(e,r,t=!1,n=!1)=>{if(t===!0)return e.output;const a=r||{},c=a.contains?"":"^",l=a.contains?"":"$";let d=`${c}(?:${e.output})${l}`;e&&e.negated===!0&&(d=`^(?!${d}).*$`);const f=H.toRegex(d,r);return n===!0&&(f.state=e),f};H.makeRe=(e,r={},t=!1,n=!1)=>{if(!e||typeof e!="string")throw new TypeError("Expected a non-empty string");let a={negated:!1,fastpaths:!0};return r.fastpaths!==!1&&(e[0]==="."||e[0]==="*")&&(a.output=He.fastpaths(e,r)),a.output||(a=He(e,r)),H.compileRe(a,r,t,n)};H.toRegex=(e,r)=>{try{const t=r||{};return new RegExp(e,t.flags||(t.nocase?"i":""))}catch(t){if(r&&r.debug===!0)throw t;return/$^/}};H.constants=br;var wr=H;const gt=wr,Cr=ue;function mt(e,r,t=!1){return r&&(r.windows===null||r.windows===void 0)&&(r={...r,windows:Cr.isWindows()}),gt(e,r,t)}Object.assign(mt,gt);var Or=mt;const Lr=wt(Or);function rt(e,r){const t={dot:!0,contains:!0};return r.some(n=>{const a=n.replace(/\*/g,"**");return Lr.isMatch(e,a,t)})}function nt(e,r){try{const t=Le.matchPattern(r,Le.presets.chrome);return t.valid&&t.match(e)}catch{return!1}}function Tr(e,r){if(!e.enabled)return!1;try{const t=e.urlMatchInclude&&e.urlMatchInclude.length>0&&nt(r,e.urlMatchInclude),n=e.urlInclude&&e.urlInclude.length>0&&rt(r,e.urlInclude),a=e.urlMatchExclude&&e.urlMatchExclude.length>0&&nt(r,e.urlMatchExclude),c=e.urlExclude&&e.urlExclude.length>0&&rt(r,e.urlExclude);return!!((t||n)&&!(a||c))}catch{return!1}}const Hr=/\/\/\s*==UserScript==\s*([\s\S]*?)\/\/\s*==\/UserScript==/,Pr=/\/\/\s*@([\w-]+)\s+(.+)/g;function Mr(e){const r=Hr.exec(e);if(!r)return null;const t=r[1]??"",n={match:[]};let a;const c=new RegExp(Pr.source,"g"),l={"exclude-match":"excludeMatch",iconurl:"iconURL"},d=["match","include","exclude","excludeMatch","grant","require"],f=["name","version","namespace","description","author","icon","iconURL","defaulticon"];for(;(a=c.exec(t))!==null;){const _=a[1],i=a[2];if(!_||!i)continue;const g=_.toLowerCase(),y=l[g]??g,A=i.trim();d.includes(y)?(n[y]=n[y]||[],n[y].push(A)):f.includes(y)&&(n[y]=A)}return n}const kr="require:";function yt(e){return`${kr}${e}`}async function _t(e){const r=yt(e),n=(await chrome.storage.local.get(r))[r];return(n==null?void 0:n.content)||null}async function Ir(e){const r=await _t(e);if(r)return r;try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.text();return await chrome.storage.local.set({[yt(e)]:{content:n,fetchedAt:Date.now()}}),n}catch(t){throw console.warn(`[QuillMonkey] Failed to fetch @require: ${e}`,t),t}}async function Ur(e){const r=[];for(const t of e){let n=await _t(t);if(!n)try{n=await Ir(t)}catch(a){console.warn(`[QuillMonkey] Failed to fetch @require: ${t}`,a);continue}r.push(n)}return r}const Nr="https://quillmonkey.com",Dr={contactHelp:`${Nr}/contact-help`},Rt=`/* oxlint-disable no-undef, @typescript-eslint/no-unused-vars */
// This file is imported as a raw string and injected into browser page context.
// Browser globals (window, document, Element, etc.) are available at runtime.
var MAX_DEPTH = 5;
function serializeResult(value, depth) {
  if (depth === undefined) depth = 0;
  if (depth > MAX_DEPTH) return "[max depth]";
  if (value === null || value === undefined) return value;
  if (typeof value === "symbol") return String(value);
  if (typeof value === "bigint") return String(value);
  if (typeof value === "function") return "[function]";
  if (value instanceof Error) {
    return { _type: "Error", message: value.message, stack: value.stack };
  }
  if (value instanceof Date) return value.toISOString();
  if (value instanceof RegExp) return value.toString();
  if (value instanceof Promise) return "[Promise]";
  if (value instanceof WeakMap) return "[WeakMap]";
  if (value instanceof WeakSet) return "[WeakSet]";
  if (value instanceof Map) {
    return {
      _type: "Map",
      entries: Array.from(value.entries()).map(function (e) {
        return [
          serializeResult(e[0], depth + 1),
          serializeResult(e[1], depth + 1),
        ];
      }),
    };
  }
  if (value instanceof Set) {
    return {
      _type: "Set",
      values: Array.from(value).map(function (v) {
        return serializeResult(v, depth + 1);
      }),
    };
  }
  if (value instanceof ArrayBuffer) {
    return { _type: "ArrayBuffer", byteLength: value.byteLength };
  }
  if (ArrayBuffer.isView(value)) {
    return { _type: value.constructor.name, byteLength: value.byteLength };
  }
  if (value === window) return "[Window]";
  if (value === document) return "[Document]";
  if (value instanceof Element) {
    return {
      _type: "Element",
      tag: value.tagName.toLowerCase(),
      id: value.id || null,
      classes: Array.from(value.classList),
      text: (value.textContent || "").trim(),
    };
  }
  if (value instanceof Node) {
    return {
      _type: "Node",
      nodeType: value.nodeType,
      nodeName: value.nodeName,
      text: (value.textContent || "").trim(),
    };
  }
  if (value instanceof NodeList || value instanceof HTMLCollection) {
    return Array.from(value).map(function (v) {
      return serializeResult(v, depth + 1);
    });
  }
  if (Array.isArray(value)) {
    return value.map(function (v) {
      return serializeResult(v, depth + 1);
    });
  }
  if (typeof value === "object") {
    var obj = {};
    var keys = Object.keys(value);
    for (var i = 0; i < keys.length; i++) {
      try {
        obj[keys[i]] = serializeResult(value[keys[i]], depth + 1);
      } catch (e) {
        obj[keys[i]] = "[error reading property]";
      }
    }
    return obj;
  }
  return value;
}
`,Et=`var _logs = [];
  var _origLog = console.log;
  var _origWarn = console.warn;
  var _origError = console.error;
  function _capture(level) {
    return function() {
      var args = [];
      for (var i = 0; i < arguments.length; i++) args.push(serializeResult(arguments[i]));
      _logs.push({ level: level, args: args });
    };
  }
  console.log = _capture("log");
  console.warn = _capture("warn");
  console.error = _capture("error");`,st=`console.log = _origLog;
    console.warn = _origWarn;
    console.error = _origError;`,jr=Rt.split(`
`).length+Et.split(`
`).length;function Br(e){return{code:`(function() {
  ${Rt}
  ${Et}
  try {
    ${e}
    ${st}
    return { success: true, logs: _logs };
  } catch (e) {
    ${st}
    return { success: false, error: e.stack || e.message || String(e), logs: _logs };
  }
})()`,linesBefore:2+jr+1}}const At="scripts";async function Be(){const{scripts:e=[]}=await chrome.storage.local.get(At);return e}async function xt(e){await chrome.storage.local.set({[At]:e})}const ot=`User Scripts must be enabled to run code. To enable: 1. Go to chrome://extensions, 2. Click 'Details' on QuillMonkey, 3. Enable 'Allow User Scripts' toggle. If it still doesn't work, visit ${Dr.contactHelp}`;async function Gr(e){var c;const r=Mr(e);if(!((c=r==null?void 0:r.require)!=null&&c.length))return e;const n=(await chrome.storage.local.get("scriptRules")).scriptRules;if((n==null?void 0:n.allowRequire)===!1)return e;const a=await Ur(r.require);return a.length===0?e:(console.log(`[QuillMonkey] Prepending ${a.length} @require dependencies`),a.join(`

`)+`

`+e)}async function Fr(e,r){if(!chrome.userScripts||!chrome.userScripts)return{success:!1,permissionIssue:"USERSCRIPTS_REQUIRED",error:ot};const t=await Gr(r),{code:n}=Br(t);try{const a=await chrome.userScripts.execute({target:{tabId:e},js:[{code:n}]}),c=a==null?void 0:a[0];return(c==null?void 0:c.result)!=null?c.result:{success:!1,error:`Script returned no result â€” the code may have failed to inject. Got: ${JSON.stringify(c)}`}}catch(a){const c=a,l=c.message||String(a);return l.includes("is not available")?{success:!1,permissionIssue:"USERSCRIPTS_REQUIRED",error:ot}:{success:!1,error:c.stack||l}}}async function Qr(e,r,t){const n=await Fr(e,t);try{const c=(await Be()).map(l=>{if(l.id!==r)return l;const d={...l.lastOutputPerTabId},f={timestamp:new Date().toISOString(),logs:n.logs};return n.success||(f.error={errorText:n.error||"Unknown error"}),d[e]=f,{...l,lastOutputPerTabId:d}});await xt(c)}catch(a){console.error("[QuillMonkey] Failed to save script output to storage:",a)}return n}function Wr(e,r){var c;const t=e.versions;if(!(t!=null&&t.length))return"";const n=t[0];if(!n)return"";let a=n.code;return n.commit!==e.currentCommit&&(a=((c=t.find(l=>l.commit===e.currentCommit))==null?void 0:c.code)??""),a}const St="offscreen.html";let ne=null,ge=null,me=null;async function vt(){return(await chrome.runtime.getContexts({contextTypes:[chrome.runtime.ContextType.OFFSCREEN_DOCUMENT],documentUrls:[chrome.runtime.getURL(St)]})).length>0}async function Kr(){if(await vt())return;if(ne){await ne;return}const e=new Promise(r=>{ge=r});ne=chrome.offscreen.createDocument({url:St,reasons:[chrome.offscreen.Reason.USER_MEDIA],justification:"Recording audio from microphone for transcription"}),await ne,ne=null,await Promise.race([e,new Promise(r=>setTimeout(r,2e3))]),ge=null}async function at(){await vt()&&await chrome.offscreen.closeDocument()}async function qr(e){try{await chrome.tabs.sendMessage(e,{action:"ping"})}catch{await chrome.scripting.executeScript({target:{tabId:e},files:["dist/content.js"]}),await new Promise(n=>setTimeout(n,50))}const r=new Promise(n=>{me=n});await chrome.tabs.sendMessage(e,{action:"injectMicPermissionIframe"});const t=await Promise.race([r,new Promise(n=>setTimeout(()=>n(!1),3e4))]);me=null;try{await chrome.tabs.sendMessage(e,{action:"removeMicPermissionIframe"})}catch{}return t}chrome.runtime.onMessage.addListener((e,r,t)=>{if(e.action==="offscreen:startRecording")return(async()=>{try{const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(n!=null&&n.id)){t({success:!1,error:"No active tab found"});return}const a=n.url||"";if(!a.startsWith("http://")&&!a.startsWith("https://")){t({success:!1,error:"Microphone recording not available on this page"});return}if(!await qr(n.id)){t({success:!1,error:"Microphone permission denied"});return}await Kr(),chrome.runtime.sendMessage({action:"startRecording"}),t({success:!0})}catch(n){t({success:!1,error:n.message})}})(),!0;if(e.action==="offscreen:stopRecording")return chrome.runtime.sendMessage({action:"stopRecording"}),t({success:!0}),!0;if(e.action==="offscreen:cancelRecording")return chrome.runtime.sendMessage({action:"cancelRecording"}),at(),t({success:!0}),!0;if(e.action==="offscreenReady")return ge&&ge(),!1;if(e.action==="micPermissionResult"){const n=e.granted;return me&&me(n),!1}return e.action==="recordingComplete"||e.action==="recordingError"||e.action==="recordingCancelled"?(at(),!1):(e.action==="openUserscriptSettings"&&chrome.tabs.create({url:`chrome://extensions/?id=${chrome.runtime.id}`}),!1)});const Ge=async(e,r)=>{const t=new URLSearchParams;t.set("tabId",e.toString()),await chrome.sidePanel.setOptions({tabId:e,path:`dist/sidepanel.html?${t.toString()}`,enabled:!0})};let re=!1;chrome.storage.session.get(null).then(e=>{for(const r of Object.keys(e))if(r.startsWith("panelOpen:")){re=!0;break}});chrome.runtime.onConnect.addListener(e=>{e.name==="sidePanel"&&(re=!0,e.onDisconnect.addListener(()=>{re=!1}))});const Xr=e=>{e.id&&(re?(chrome.sidePanel.close({tabId:e.id}),re=!1):(chrome.sidePanel.open({tabId:e.id}),re=!0))};chrome.action.onClicked.addListener(Xr);chrome.tabs.onActivated.addListener(async e=>{const r=await chrome.tabs.get(e.tabId),t=r.url||r.pendingUrl;!t||t.startsWith("chrome://")||await Ge(e.tabId)});chrome.tabs.onCreated.addListener(async e=>{const r=e.url||e.pendingUrl;!r||r.startsWith("chrome://")||e.id&&await Ge(e.id)});chrome.runtime.onInstalled.addListener(async e=>{const r=await chrome.tabs.query({});for(const t of r)t.id&&await Ge(t.id);chrome.contextMenus.create({id:"quillmonkey-element-picker",title:"Edit Element with QuillMonkey",contexts:["all"]}),e.reason==="install"&&chrome.tabs.create({url:"https://quillmonkey.com/new-user-instructions"})});async function zr(e){try{return await chrome.tabs.sendMessage(e,{action:"ping"}),!0}catch{try{return await chrome.scripting.executeScript({target:{tabId:e},files:["dist/content.js"]}),await new Promise(r=>setTimeout(r,50)),!0}catch(r){return console.error("[QuillMonkey] Failed to inject content script:",r),!1}}}chrome.contextMenus.onClicked.addListener(async(e,r)=>{if(e.menuItemId==="quillmonkey-element-picker"&&(r!=null&&r.id)&&(chrome.sidePanel.open({tabId:r.id}),await zr(r==null?void 0:r.id)))try{await chrome.tabs.sendMessage(r==null?void 0:r.id,{action:"startElementPicker"})}catch(n){console.error("[QuillMonkey] Failed to start element picker:",n)}});async function Vr(e,r){if(!r.startsWith("http://")&&!r.startsWith("https://"))return;const n=(await chrome.storage.local.get("userPrefs")).userPrefs;if((n==null?void 0:n.autoApplyScripts)!==!1)try{const c=(await Be()).filter(l=>Tr(l,r));await Promise.allSettled(c.map(l=>Qr(e,l.id,Wr(l))))}catch(a){console.error("[QuillMonkey] Error applying scripts:",a)}}chrome.tabs.onRemoved.addListener(async e=>{const r=await Be();if(!r.some(a=>{var c;return(c=a.lastOutputPerTabId)==null?void 0:c[e]}))return;const n=r.map(a=>{var l;if(!((l=a.lastOutputPerTabId)!=null&&l[e]))return a;const c={...a.lastOutputPerTabId};return delete c[e],{...a,lastOutputPerTabId:c}});await xt(n)});chrome.tabs.onUpdated.addListener(async(e,r,t)=>{r.status==="complete"&&t.url&&await Vr(e,t.url)});
